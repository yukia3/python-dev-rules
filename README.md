# python-dev-rules
## プロジェクト設定
black + flake8 を基本とする。

## 各種ルール
[Effective Python](https://www.amazon.co.jp/dp/0134853989/)を原則として準拠する。
以下、特に守りたい点を列挙していく。

### 基本
* PEP8スタイルガイドに従う。
	* <空白>
		* インデントには、タブではなく4個の半角スペースを使う
		* 各行は長さ79文字かそれ以下とする
		* 長い式を続けるための次の行を使うには、通常インデントにさらにインデント1つを追加する形とする
		* 関数とクラスは空白2行で分ける
		* クラスでは、メソッドは空白行で分ける
		* 辞書ではキー所の間には空白をおかず、同じ行に値を書く場合には空白1つを置く（型ヒントも同様）
		* 変数代入の前後には、空白を1つ、必ず1つだけを置く。
	* <名前付け>
		* 関数、変数、属性は、lowercase_underscoreのように小文字でアンダースコアを挟む
		* プロテクテッド属性は先頭に_をつける
		* プライベート属性は先頭に__をつける
		* クラスと例外はアッパーキャメルケースとする
		* モジュールの定数はALL_CAPSとする
		* クラスのインスタンスメソッドは第一パラメータにselfを使う
		* クラスメソッドは第一パラメータにclsを使う。
	* <式と文>
		* 式の否定（if not a is b）ではなく、内側の項の否定（if a is not b）を使う
		* コンテナやシーケンスの長さ（len(somelist) == 0）を使って空値を判定せず、空値が暗黙的にFalseと判定されることを使う（not somelist）
		* if文、forループ、whileループexcept複合文は1行では書かない
		* 式が1行に収まらない場合には、カッコで括って複数行にする（\で分けるよりはカッコで分けたほうがいい）
	* <インポート>
		* import文は常にファイルの先頭に置く
		* インポートするときは、常にモジュールの絶対名を使い、モジュールのパスからの相対名を使わない。（bar内だとしても、from bar import fooを使う）
		* 相対インポートを使わなければならない時には、明示的な from . import foo を使う
		* インポートは 標準ライブラリ→サードパーティ→自作モジュールの順で、さらにアルファベット順にインポートする。

* bytesとstrの取り扱い
	* インタフェースの一番遠い箇所でUnicodeの符号化と複合化を行う（Unicode サンドイッチ）[Pragmatic Unicode](https://nedbatchelder.com/text/unipain/unipain.html#1) 外はbytes、中はstr
	* ファイル読み書きはデフォルトでunicode（str）なので、bytesなどを扱う際には”rb”/“wb”モードを利用すること。


* Cスタイルフォーマット、str.formatは使わず、f文字列で埋め込む
* 複雑な式になる場合には、適度に関数を分ける
* インデックス[i]が並ぶ場合には、複数代入アンパック（a, b = arr）を検討する
* ループで連番が必要な場合は、range ではなく enumerateを使う
* イテレータを並列処理する際には、zipを使う
* for ループと while ループの後の else ブロックは使わない



### リストと辞書
* スライスでの冗長表現を避ける（「0」や「文字長の指定」）
* 1 つの式では、ストライドとスライスを同時に使わない（[2::2]など） = isliceの利用も検討する
* スライスではなく catch-all アンパックを検討する（〜, *others = args）



### 関数
* 4 個以上の変数をアンパックするのはエラーになりやすいので避けて、代わりに軽量なクラスか namedtuple インスタンスを検討する。
* None を返すのではなく例外を送出する
* オプションのキーワード引数は、位置ではなくキーワードで常に渡す
* 動的なデフォルト引数を指定するときには、デフォルトを None として docstring でNoneの場合にどのような振る舞いをするかを記述、処理冒頭でNone判定して初期値を設定する（関数パラメータは関数が定義されるタイミングの1度しか初期化されないため）
* キーワード専用引数と位置専用引数で明確さを高める



### 内包表記とジェネレータ
* map や filter の代わりにリスト内包表記を使う
* 内包表記では、3 つ以上の式を避ける
* リストを返さずにジェネレータ（yieldを使った関数）を返すことを考える

